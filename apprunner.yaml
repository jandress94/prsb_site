version: 1.0
runtime: python311
build:
  commands:
    build:
      - echo "build command"
run:
  runtime-version: 3.11
  pre-run:
    - echo "Installing dependencies"
    - pip3 install poetry==2.0.1
    - poetry install --no-root --only=main
    - mv prsb prsb-temp
    - mv prsb-temp/* prsb-temp/.* ./
    - rm -r prsb-temp
  command: poetry run gunicorn prsb.wsgi:application --bind 0.0.0.0:8000
  network:
    port: 8000
    env: MY_APP_PORT
  env:
    - name: ALLOWED_HOSTS
      value: "https://7mupxdnepb.us-west-2.awsapprunner.com/"
  secrets:
    - name: PG_HOST
      value-from: "arn:aws:secretsmanager:us-west-2:905418288995:secret:prsb_pg_dev-TLuCiW:host::"
    - name: PG_PASSWORD
      value-from: "arn:aws:secretsmanager:us-west-2:905418288995:secret:prsb_pg_dev-TLuCiW:password::"